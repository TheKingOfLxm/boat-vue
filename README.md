# 船舶火灾监控系统使用文档

## 1. 系统概述

本系统是一个基于 Vue.js 开发的船舶火灾监控可视化平台，提供了船舶三维模型展示、火灾模拟、实时数据监控和警报管理等功能。系统主要用于模拟和监控船舶不同舱室（机舱、货舱、驾驶室）的火灾情况，并通过直观的视觉界面展示火灾发展过程及关键数据指标。

### 1.1 系统特点

- **三维船舶模型**：使用 Three.js 实现的交互式 3D 船舶模型，支持舱室的高亮显示和动态切换
- **实时火灾模拟**：精确模拟不同舱室的火灾发展过程，包括温度、烟雾、氧气和一氧化碳浓度变化
- **数据可视化**：通过仪表盘和趋势图实时展示各监测指标的变化
- **智能警报系统**：根据监测数据自动生成不同级别的警报信息
- **响应式界面**：支持面板的展开/收起，适应不同的显示需求

## 2. 系统架构

### 2.1 前端技术栈

- Vue.js 3 框架
- Three.js 3D 渲染库
- ECharts 数据可视化组件
- Vue Router 路由管理

### 2.2 主要组件结构

系统采用组件化设计，主要包括以下几个核心组件：

- **MyIndex**：主界面组件，负责整体布局和组件间通信
- **MainView**：3D 船舶模型显示组件，负责渲染船舶模型和火灾效果
- **LeftPanel**：左侧面板，显示船舶基本信息和风险分布
- **RightPanel**：右侧面板，显示实时监控数据、趋势图和警报信息
- **BottomBar**：底部控制栏，提供舱室选择和火灾启停控制
- **FireSimulator**：火灾模拟器，负责生成模拟数据和警报

## 3. 功能模块详解

### 3.1 船舶三维模型（MainView）

此模块使用 Three.js 实现了船舶的三维可视化，主要功能包括：

- 船舶模型的加载和渲染
- 舱室的高亮显示（选中时）
- 视角自动切换（根据选中的舱室）
- 火灾粒子效果模拟

#### 舱室配置

系统预设了三个主要舱室：

| 舱室ID | 舱室名称 | 位置特点 | 火灾特性         |
| ------ | -------- | -------- | ---------------- |
| 1      | 机舱     | 船体中部 | 快速发展，高温   |
| 2      | 货舱     | 船体底部 | 缓慢发展，烟雾多 |
| 3      | 驾驶室   | 船体上部 | 极慢发展，低烟雾 |

### 3.2 火灾模拟系统（FireSimulator）

火灾模拟器是系统的核心组件，负责模拟不同舱室的火灾发展过程并生成相关数据：

- **基础数据模拟**：根据不同舱室的特性，模拟温度、烟雾、氧气和一氧化碳浓度变化
- **火灾发展曲线**：使用对数函数模拟火灾增长过程，贴近真实场景
- **随机波动**：添加随机波动使数据更加真实
- **警报生成**：根据预设阈值自动生成不同级别的警报

#### 监测指标基础值

| 舱室类型 | 温度(°C) | 烟雾浓度(ppm) | 氧气浓度(%) | 一氧化碳(ppm) |
| -------- | -------- | ------------- | ----------- | ------------- |
| 机舱     | 45       | 50            | 20.9        | 5             |
| 货舱     | 25       | 20            | 20.9        | 2             |
| 驾驶室   | 22       | 10            | 20.9        | 1             |

#### 火灾发展参数

每个舱室的火灾发展特性不同：

- **机舱**：温度快速上升（最高180°C），烟雾浓度中等（最高450ppm）
- **货舱**：温度缓慢上升（最高150°C），烟雾浓度高（最高500ppm）
- **驾驶室**：温度缓慢上升（最高100°C），烟雾浓度低（最高300ppm）

#### 警报阈值

| 指标类型 | 中度警报阈值 | 高级警报阈值 |
| -------- | ------------ | ------------ |
| 温度     | 50°C         | 70°C         |
| 烟雾浓度 | 150ppm       | 250ppm       |
| 氧气浓度 | 19%          | 17%          |
| 一氧化碳 | 40ppm        | 80ppm        |

### 3.3 实时监控面板（RightPanel）

右侧面板负责显示实时监控数据和警报信息，主要包括：

- **仪表盘**：显示当前选中指标（温度、烟雾、氧气或一氧化碳）的实时值
- **趋势图**：展示各监测指标随时间变化的趋势
- **警报区域**：显示系统生成的各种警报信息

#### 数据更新机制

- 系统启动后，RightPanel 每秒从 FireSimulator 获取一次最新数据
- 当火灾状态或选中舱室变化时，立即更新数据
- 图表数据保持最近6个时间点的历史记录

### 3.4 船舶信息面板（LeftPanel）

左侧面板主要显示船舶的基本信息和风险分析：

- **船舶基本信息**：包括船舶编号、类型、吨位和建造年份
- **火灾风险分布**：使用饼图展示各舱室的火灾风险指数
- **风险趋势**：展示风险变化的历史趋势

### 3.5 控制面板（BottomBar）

底部控制栏提供了系统的主要交互控制：

- **舱室选择**：可切换监控的舱室（机舱、货舱或驾驶室）
- **火灾控制**：可启动或停止火灾模拟
- **系统状态**：显示系统运行状态和当前时间

## 4. 使用指南

### 4.1 基本操作流程

1. **系统启动**：

   - 系统启动后默认选中机舱，且火灾处于关闭状态
   - 三个面板（左、右、底）默认处于展开状态

2. **舱室选择**：

   - 点击底部控制栏的舱室按钮（机舱、货舱、驾驶室）切换监控对象
   - 选中后，3D 模型中对应舱室会高亮显示，同时相机会自动调整到最佳视角

3. **火灾模拟**：

   - 点击底部控制栏的"开启火焰"按钮启动火灾模拟
   - 模拟开始后，选中舱室会显示火焰效果，同时右侧面板数据开始实时更新
   - 可随时点击"关闭火焰"按钮停止火灾模拟

4. **界面调整**：
   - 可点击面板边缘的箭头按钮收起/展开对应面板
   - 收起面板可获得更大的 3D 模型显示空间

### 4.2 数据监控

1. **指标查看**：

   - 在右侧面板的仪表盘部分，可点击不同的监测指标（温度、烟雾、氧气、一氧化碳）切换查看
   - 仪表盘显示当前值，并根据数值自动变色（绿色-安全，黄色-警告，红色-危险）

2. **趋势分析**：

   - 趋势图显示所有指标的历史变化趋势
   - 可观察指标上升/下降速率，辅助判断火灾发展态势

3. **警报处理**：
   - 警报区域会自动显示系统生成的警报信息
   - 高级警报（红色）表示严重危险，需要立即处理
   - 中度警报（黄色）表示潜在风险，需要密切关注

## 5. 技术实现细节

### 5.1 火灾模拟算法

```javascript
// 火灾增长计算
const growth = Math.min(1, Math.log(1 + elapsed * 0.1) / Math.log(10));

// 值的计算（上升型指标）
calculateValue(baseValue, maxValue, growth, fluctuation) {
  const growthValue = baseValue + (maxValue - baseValue) * growth;
  const randomFluctuation = (Math.random() - 0.5) * 2 * fluctuation * growth;
  return Math.min(maxValue, Math.max(baseValue, growthValue + randomFluctuation));
}

// 值的计算（下降型指标，如氧气）
calculateValueDecreasing(baseValue, minValue, growth, fluctuation) {
  const decreaseValue = baseValue - (baseValue - minValue) * growth;
  const randomFluctuation = (Math.random() - 0.5) * 2 * fluctuation * growth;
  return Math.max(minValue, Math.min(baseValue, decreaseValue + randomFluctuation));
}
```

### 5.2 火焰粒子系统

火焰粒子效果使用 Three.js 的粒子系统实现，通过控制粒子的颜色、大小、位置和运动来模拟逼真的火焰效果：

- 使用不同大小和颜色的粒子创建火焰效果
- 通过调整粒子的生命周期和上升速度控制火焰高度
- 通过随机分布和颜色渐变增强火焰的真实感

### 5.3 数据通信机制

系统采用 Vue 的响应式数据和事件机制实现组件间通信：

- **Props 传递**：从父组件向子组件传递数据（如 isFireActive, selectedCompartment）
- **事件发射**：子组件通过 emit 事件向父组件发送消息
- **状态监听**：使用 watch 监听状态变化并触发相应操作

## 6. 常见问题与解决方案

### 6.1 数据更新问题

**问题**：火灾激活后实时警报不更新

**解决方案**：

- 检查 watch 监听逻辑是否正确
- 确认 FireSimulator 状态是否正确设置
- 设置 watch 选项为 immediate: true 确保首次渲染时执行

### 6.2 显示问题

**问题**：某些舱室高亮效果不明显

**解决方案**：

- 调整高亮材质的发光强度 (emissiveIntensity)
- 增加高亮区域半径
- 为特定舱室定制专门的高亮逻辑

## 7. 未来功能计划

1. **多船舶支持**：扩展系统以支持多艘船舶的同时监控
2. **历史数据分析**：添加历史数据查询和分析功能
3. **火灾蔓延模拟**：模拟火灾在舱室间的蔓延过程
4. **智能预警系统**：基于机器学习算法预测火灾发展趋势
5. **应急响应流程**：集成标准应急响应流程和建议
